service: IR
package:
  exclude: 
    - .*
    - tests/**
    - scripts/**
    - node_modules/**
    - dev-dependencies/**
  include:
    - src/**

provider:
  name: aws
  runtime: python2.7
  environment: 
    TEAM_NAME: bret_sandbox_reaper
    TEAM_EMAIL: bret.waldow+reaper@mechanicalrock.io
  iamRoleStatements:
    - Effect: Allow
      Action: 
        - ec2:*
        - cloudwatch:*
        - s3:*
        - ses:SendRawEmail
      Resource: "*"

plugins:
  - serverless-python-requirements
  - serverless-sam

frameworkVersion: ">=1.1.0 <2.0.0"

custom:
  pythonRequirements:
    dockerizePip: true
    invalidateCaches: true
    fileName: requirements.txt

resources:
  Description: Instance Reaper stack
  Resources:
    LoggingBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: instance-reaper-{team.name}-logging

functions:
  instance-reaper:
    handler: src/handler.reaper_event_handler
    memorySize: 1024
    timeout: 300
    events:
      - schedule: rate(3 hours)
